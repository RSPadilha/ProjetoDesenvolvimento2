<div class="novo-pedido-header">
   <h1>Nova Solicitação</h1>
   <div class="novo-pedido-divider"></div>
</div>

<div class="cliente-form-container">
   <div *ngIf="loading" class="loading-message">
      <p>Processando...</p>
   </div>

   <div *ngIf="!usuarioId" class="error-message">
      <p>Erro: Usuário não encontrado. Faça login novamente.</p>
   </div>

   <div *ngIf="usuarioId && !loading" class="cliente-form-content">
      <div class="cliente-form-row">
         <div class="cliente-form-col">
            <label for="tipo-servico">Tipo de Serviço *</label>
            <select id="tipo-servico" [(ngModel)]="novoPedidoForm.idServico" [disabled]="loading">
               <option value="">Selecione um serviço</option>
               @for (servico of tiposServico; track servico.id) {
               <option [value]="servico.id">{{ servico.nome }}</option>
               }
            </select>

            <label for="descricao">Descrição *</label>
            <textarea id="descricao" [(ngModel)]="novoPedidoForm.descricao"
               placeholder="Descreva detalhadamente o serviço desejado..." [disabled]="loading" rows="3">
            </textarea>
         </div>

         <div class="cliente-form-col">
            <label for="endereco">Endereço *</label>
            <select id="endereco" [(ngModel)]="novoPedidoForm.idEndereco" [disabled]="loading">
               <option value="">Selecione um endereço</option>
               @for (endereco of enderecos; track endereco.id) {
               <option [value]="endereco.id">
                  {{ endereco.rua }}, {{ endereco.numero }}
               </option>
               }
            </select>

            <div *ngIf="enderecos.length === 0" class="info-message">
               <p>Nenhum endereço cadastrado. <a href="/minhaconta">Cadastre um endereço</a> para continuar.</p>
               <button type="button" class="btn-secondary" (click)="recarregarEnderecos()" [disabled]="loading">
                  Recarregar Endereços
               </button>
            </div>
         </div>
      </div>

      <button class="cliente-form-btn" (click)="novoPedido()"
         [disabled]="loading || !novoPedidoForm.idServico || !novoPedidoForm.descricao.trim() || !novoPedidoForm.idEndereco">
         {{ loading ? 'Processando...' : 'Criar Pedido' }}
      </button>
   </div>
</div>

<div class="pedidos-section">
   <div class="pedidos-header">
      <h2>Seus Pedidos</h2>
      <div class="pedidos-divider"></div>
   </div>

   <div *ngIf="pedidos.length === 0" class="empty-message">
      <p>Você ainda não possui pedidos. Crie sua primeira solicitação acima!</p>
   </div>

   <div *ngIf="pedidos.length > 0" class="pedidos-table-wrapper">
      <table class="pedidos-table">
         <thead>
            <tr>
               <th>Tipo de Serviço</th>
               <th>Descrição</th>
               <th>Endereço</th>
               <th>Data Criação</th>
               <th>Status</th>
               <th>Valor</th>
            </tr>
         </thead>
         <tbody>
            @for (pedido of pedidos; track pedido.id) {
            <tr>
               <td>{{ pedido.nome_servico }}</td>
               <td class="descricao-cell">{{ pedido.descricao }}</td>
               <td class="endereco-cell">{{ pedido.endereco_completo }}</td>
               <td>{{ formatarData(pedido.dataCriacao) }}</td>
               <td>
                  <span class="status-badge" [class]="'status-' + pedido.status.toLowerCase()">
                     {{ pedido.status }}
                  </span>
               </td>
               <td>{{ pedido.valor ? (pedido.valor | currency:'BRL':'symbol':'1.2-2') : 'A definir' }}</td>
            </tr>
            }
         </tbody>
      </table>
   </div>
</div>